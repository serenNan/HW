# Windy Gridworld 坐标系统完全正确版

## 🎯 两个坐标系统对比

### PDF坐标系（代码中使用）
- **行号（Row）**：1-7，**从上往下**递增
- **列号（Column）**：1-10，**从左往右**递增
- **原点(1,1)**：左上角
- **格式**：(row, col)

### 图形显示坐标系（matplotlib）
- **行号（Y轴）**：0-7，**从下往上**递增
- **列号（X轴）**：0-10，**从左往右**递增
- **原点(0,0)**：左下角
- **格式**：(x, y) 或 (col, row)

---

## 🔄 坐标转换公式

### PDF → 图形显示
```python
图中Y = 7 - PDF行号
图中X = PDF列号 - 1
```

### 图形显示 → PDF
```python
PDF行号 = 7 - 图中Y
PDF列号 = 图中X + 1
```

---

## 🗺️ 完整对照图

```
PDF坐标系视角（代码使用）：
═══════════════════════════════════════════════════════════
        列→  1    2    3    4    5    6    7    8    9   10
行↓    ┌────┬────┬────┬────┬────┬────┬────┬────┬────┬────┐
  1    │1,1 │    │    │🔵  │    │    │1,7 │    │    │☠️  │  ← 第1行（顶部）
       │原点│    │    │1,4 │    │    │    │    │    │1,10│
       ├────┼────┼────┼────┼────┼────┼────┼────┼────┼────┤
  2    │    │    │    │    │    │    │    │    │    │    │
  3    │    │    │    │    │    │    │    │    │    │    │
       ├────┼────┼────┼────┼────┼────┼────┼────┼────┼────┤
  4    │4,1 │    │    │    │    │    │    │🎯  │    │    │  ← 第4行（中间）
       │    │    │    │    │    │    │    │4,8 │    │    │
       ├────┼────┼────┼────┼────┼────┼────┼────┼────┼────┤
  5    │    │    │    │    │    │    │    │    │    │    │
  6    │    │    │    │    │    │    │    │    │    │    │
       ├────┼────┼────┼────┼────┼────┼────┼────┼────┼────┤
  7    │7,1 │    │    │    │    │    │    │    │    │    │  ← 第7行（底部）
       │    │    │    │    │    │    │    │    │7,10│
       └────┴────┴────┴────┴────┴────┴────┴────┴────┴────┘
风力：   0    0    0    1    1    1    2    2    1    0
       ↑    ↑    ↑    ↑    ↑    ↑   ↑↑  ↑↑   ↑    ↑


图形显示坐标系（你看到的图）：
═══════════════════════════════════════════════════════════
  Y↑
  7    ┌────┬────┬────┬────┬────┬────┬────┬────┬────┬────┐
       │0,7 │    │    │🔵  │    │    │    │    │    │☠️  │  ← 顶部
       │    │    │    │3,7 │    │    │    │    │    │9,7 │     PDF第1行
       ├────┼────┼────┼────┼────┼────┼────┼────┼────┼────┤
  6    │    │    │    │    │    │    │    │    │    │6   │
  5    │    │    │    │    │    │    │    │    │    │    │
       ├────┼────┼────┼────┼────┼────┼────┼────┼────┼────┤
  4    │    │    │    │    │    │    │    │    │    │    │
  3    ┤0,3 │    │    │    │    │    │    │🎯  │    │    │  ← 中间
       │    │    │    │    │    │    │    │7,3 │    │    │     PDF第4行
       ├────┼────┼────┼────┼────┼────┼────┼────┼────┼────┤
  2    │    │    │    │    │    │    │    │    │    │    │
  1    │    │    │    │    │    │    │    │    │    │    │
       ├────┼────┼────┼────┼────┼────┼────┼────┼────┼────┤
  0    │●  │    │    │    │    │    │    │    │    │    │  ← 底部
       │0,0 │    │    │    │    │    │    │    │    │9,0 │     PDF第7行
       └────┴────┴────┴────┴────┴────┴────┴────┴────┴────┘
       0    1    2    3    4    5    6    7    8    9  →X
     风力： 0    0    0    1    1    1    2    2    1    0
```

---

## 📍 关键位置对照表

| 名称 | PDF坐标 | 图形显示坐标 | 位置描述 | 验证 |
|------|---------|--------------|----------|------|
| **起点S1** | (7,1) | (0,0) | 左下角 | ✓ 绿色圆点 |
| **起点S2** | (4,1) | (0,3) | 左侧中间 | - |
| **起点S3** | (1,7) | (6,6) | 上方强风区 | - |
| **目标🎯** | (4,8) | (7,3) | 中间偏右 | ✓ 绿色方块 |
| **死亡☠️** | (1,10) | (9,6) | 右上角 | ✓ 黑色方块 |
| **吸收🔵** | (1,4) | (3,6) | 上方中间 | ✓ 蓝色方块 |
| **左上角** | (1,1) | (0,6) | - | - |
| **右上角** | (1,10) | (9,6) | - | - |
| **左下角** | (7,1) | (0,0) | - | - |
| **右下角** | (7,10) | (9,0) | - | - |

---

## 🎮 移动方向对照

### PDF坐标系中的移动
```python
'n':  (-1, 0)   # 向北：行号减1（向上）
'ne': (-1, +1)  # 东北：行号减1，列号加1
'e':  (0, +1)   # 向东：列号加1（向右）
'se': (+1, +1)  # 东南：行号加1，列号加1
's':  (+1, 0)   # 向南：行号加1（向下）
'sw': (+1, -1)  # 西南：行号加1，列号减1
'w':  (0, -1)   # 向西：列号减1（向左）
'nw': (-1, -1)  # 西北：行号减1，列号减1
```

### 在图形显示中的视觉效果
```
'n':  向上移动（Y增大）
's':  向下移动（Y减小）
'e':  向右移动（X增大）
'w':  向左移动（X减小）
```

---

## 🌪️ 风力效果详解

### PDF坐标系视角
风力：**减小行号**（向上推）

| 列号(PDF) | 列号(图) | 风力强度 | 效果(PDF) | 效果(图) |
|-----------|----------|----------|-----------|----------|
| 1-3 | 0-2 | 0 | 无 | 无 |
| 4-6 | 3-5 | 1 | 行号-1 | Y+1 |
| 7-8 | 6-7 | 2 | 行号-2 | Y+2 |
| 9 | 8 | 1 | 行号-1 | Y+1 |
| 10 | 9 | 0 | 无 | 无 |

### 示例：风力计算
```
PDF坐标系：
  当前位置: (5, 7)
  执行动作: 'e' (0, +1)
  无风结果: (5, 8)
  列8有2格风: (5-2, 8) = (3, 8)

图形显示：
  当前位置: (6, 2)  [Y=7-5=2, X=7-1=6]
  执行动作: 向右
  无风结果: (7, 2)
  风力向上推: (7, 2+2) = (7, 4)
  对应PDF: (7-4, 7+1) = (3, 8) ✓
```

---

## 💡 理解技巧

### 记住核心区别
1. **PDF坐标**：像阅读文字（从上往下，从左往右）
   - 第1行在顶部
   - 行号增大 = 往下

2. **图形坐标**：标准数学坐标系（笛卡尔坐标）
   - Y=0在底部
   - Y增大 = 往上

### 快速转换方法
想知道PDF坐标(r, c)在图中的位置：
```
1. 列坐标简单：图中X = c - 1
2. 行坐标翻转：图中Y = 7 - r

例如：PDF(4, 8) → 图中(7, 3)
  X = 8 - 1 = 7
  Y = 7 - 4 = 3
```

---

## 📊 三个起点的详细分析

### 起点1: PDF(7,1) = 图(0,0)
```
位置：左下角（图的原点）
特点：
  - 离目标最远
  - 需要向右7格，向上3格
  - 8向移动：对角线最优

最优路径推测：
  (7,1) → ne → (6,2) → ne → (5,3) → ...
```

### 起点2: PDF(4,1) = 图(0,3)
```
位置：左侧中间（与目标同行）
特点：
  - 与目标(4,8)同行
  - 只需向右移动7格
  - 会经过强风区

策略：
  直接向东，利用风力自动调整高度
```

### 起点3: PDF(1,7) = 图(6,6)
```
位置：上方强风区
特点：
  - 已经在顶部（行号=1）
  - 列7有2格强风（但无法再往上）
  - 距离死亡(1,10)只有3格
  - 距离目标(4,8)：向下3行，向右1列

危险：
  同一行向右容易触碰死亡状态！

策略：
  必须先向南（增大行号），避开顶部
```

---

## ⚠️ 常见误解

### 误解1：图的Row就是PDF的行号
❌ **错误**：图中Row=3 ≠ PDF行号3
✅ **正确**：图中Row=3 = PDF行号4（因为7-3=4）

### 误解2：风向下吹
❌ **错误**：风向下吹，增大行号
✅ **正确**：风向**上**吹，**减小**PDF行号，**增大**图中Y坐标

### 误解3：原点在同一位置
❌ **错误**：两个坐标系的原点相同
✅ **正确**：
  - PDF原点(1,1)在左上角
  - 图原点(0,0)在左下角

---

## 🔧 代码中的坐标使用

在 `HW2_Solution.ipynb` 中：
```python
# 使用的是PDF坐标系
self.goal_state = (4, 8)      # 目标
self.death_state = (1, 10)    # 死亡
start_states = [(7, 1), (4, 1), (1, 7)]  # 三个起点

# 可视化时需要转换
def visualize_gridworld(env, path=None, policy=None):
    for r in range(1, env.rows + 1):
        for c in range(1, env.cols + 1):
            # matplotlib使用：
            # x = c - 1（列坐标）
            # y = env.rows - r（行坐标翻转）
            ax.add_patch(Rectangle((c-1, env.rows-r), 1, 1, ...))
```

---

希望这次完全正确了！🎯
